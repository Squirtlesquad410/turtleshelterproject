<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Maintain Events</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        /* Reset some default styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        /* Body styling */
        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(45deg, #ff7b7b, #ff8c00, #fbbd61);
            background-size: 300% 300%;
            animation: gradientAnimation 8s ease infinite;
            height: 100vh;
            justify-content: center;
            align-items: center;
            color: white;
            text-align: center;
            transition: all 0.3s ease-in-out;
        }


.admin-banner {
    position: fixed;  /* Fix it to the top of the page */
    top: 73px;
    left: 0;
    width: 100%;  /* Cover the full width */
    height: 40px;  /* Set the height of the banner */
    background-color: rgba(255, 165, 0, 0.8);  /* Semi-transparent dark orange (RGBA format) */
    color: white;
    text-align: center;
    font-weight: bold;
    font-size: 14px;
    z-index: 9999;  /* Ensure it stays on top of other content */
    display: flex;
    align-items: flex-end;
    justify-content: center;
    padding-top: -40px;
}

        /* Navbar Styles */
.navbar {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    background-color: rgba(0, 0, 0, 0.7);
    padding: 10px 20px;
    z-index: 10;
}

.navbar ul {
    list-style: none;
    text-align: center;
}

.navbar ul li {
    display: inline-block;
    margin: 0 15px;
    position: relative; /* Needed for dropdown */
}

.navbar ul li a {
    color: white;
    text-decoration: none;
    font-size: 18px;
    font-weight: 500;
    transition: color 0.3s;
}

.navbar ul li a:hover {
    color: #1e90ff;
}

/* Dropdown Menu */
.navbar ul li.dropdown:hover .dropdown-menu {
    display: block; /* Show the dropdown menu when hovering */
}

        /* Header styling */
        h1 {
            font-size: 3.5em;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 2px;
            margin-top: 100px;
            text-shadow: 2px 2px 10px rgba(0, 0, 0, 0.4);
        }

        /* Paragraph styling */
        p {
            font-size: 1.2em;
            font-weight: 500;
            line-height: 1.6;
            margin-top: 20px;
            color: #f7f7f7;
            text-shadow: 1px 1px 8px rgba(0, 0, 0, 0.2);
        }

        /* Button styling */
        .btn {
            margin-top: 30px;
            padding: 15px 30px;
            background-color: #ff5733;
            color: white;
            font-size: 1.2em;
            border-radius: 50px;
            text-transform: uppercase;
            font-weight: 600;
            border: none;
            cursor: pointer;
            box-shadow: 0 8px 12px rgba(0, 0, 0, 0.3);
            transition: all 0.3s ease;
        }

        .btn:hover {
            background-color: #ff3e1d;
            transform: scale(1.05);
        }

        /* Animation for gradient background */
        @keyframes gradientAnimation {
            0% {
                background-position: 0% 50%;
            }
            50% {
                background-position: 100% 50%;
            }
            100% {
                background-position: 0% 50%;
            }
        }

    </style>
</head>
<body>
    <!--Banner that appears if logged in as admin,
    that way you can make sure you have admin permissions-->
    <% if (isAdmin) { %>
        <div class="admin-banner">
            <p>Viewing page as admin</p>
        </div>
    <% } %>
    <!-- Navbar -->
    <br><br>
    <nav class="navbar">
        <ul>
            <li><a href="/admin">Admin Page</a></li>
            <br>
            <li><a href="/request-an-event">Request Event</a></li>
            <li><a href="/volunteer">Volunteer</a></li>
            <!-- Show Admin and Sign Out links if the user is logged in and an admin -->
            <% if (isLoggedIn && isAdmin) { %>
                <li><a href="/signout">Sign Out</a></li>
            <% } %>
        </ul>
    </nav>
    <br>
    <h1>Events Information:</h1>
    <!--INSERT CODE HERE TO ALLOW YOU TO VIEW OUR LIVE DATABASE
    OF EVENT INFORMATION, PROVIDE AN EDIT AND DELETE EVENT BUTON IN THE TABLE

    ALSO, PROVIDE AN "ADD EVENT" BUTTON BELOW THE TABLE
        (This is like the exact same thing we did for Test 2)-->
        <!-- Filter Form -->
<form method="GET" action="/maintain-events" class="filter-form">

    <label for="description">Description:</label>
    <input type="text" id="description" name="description" placeholder="Event description" value="<%= descriptionFilter || '' %>">

    <label for="organization">Organization Name:</label>
    <input type="text" id="organization" name="organization" placeholder="Organization" value="<%= organizationFilter || '' %>">

    <label for="city">City:</label>
    <input type="text" id="city" name="city" placeholder="City" value="<%= cityFilter || '' %>">

    <label for="state">State:</label>
    <input type="text" id="state" name="state" placeholder="State" value="<%= stateFilter || '' %>">

    <label for="zip">ZIP Code:</label>
    <input type="text" id="zip" name="zip" placeholder="ZIP" value="<%= zipFilter || '' %>">

        <label for="event_date">Event Date:</label>
        <input type="date" id="event_date" name="event_date" value="<%= dateFilter %>">

    <button type="submit">Apply Filters</button>
</form>
        <table>
            <thead>
                <tr>
                    <th>Event Date</th>
                    <th>Description</th>
                    <th>Organization</th>
                    <th>Address</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                <% events.forEach(event => { %>
                    <!-- Main Row -->
                    <tr class="clickable-row" data-id="<%= event.event_id %>">
                        <td><%= event.event_date %></td>
                        <td><%= event.event_description %></td>
                        <td><%= event.organization_name %></td>
                        <td><%= event.full_address %></td>
                        <td>
                            <button onclick="handleEdit(<%= event.event_id %>)">Edit</button>
                            <button onclick="handleDelete(<%= event.event_id %>)">Delete</button>
                        </td>
                    </tr>
                    <!-- Hidden Details Row -->
                    <tr class="details-row" id="details-<%= event.event_id %>" style="display: none;">
                        <td colspan="5">
                            <table>
                                <tbody>
                                    <tr>
                                        <td><strong>Organizer Email:</strong></td>
                                        <td><%= event.organizer_email %></td>
                                    </tr>
                                    <tr>
                                        <td><strong>Event Type:</strong></td>
                                        <td><%= event.event_type %></td>
                                    </tr>
                                    <tr>
                                        <td><strong>Estimated Attendance:</strong></td>
                                        <td><%= event.estimated_attendance %></td>
                                    </tr>
                                    <tr>
                                        <td><strong>Number of Children:</strong></td>
                                        <td><%= event.num_children_under_10 %></td>
                                    </tr>
                                    <tr>
                                        <td><strong>Number of Teens:</strong></td>
                                        <td><%= event.num_teens %></td>
                                    </tr>
                                    <tr>
                                        <td><strong>Help Needed for Setup:</strong></td>
                                        <td><%= event.num_help_set_up %></td>
                                    </tr>
                                    <tr>
                                        <td><strong>Number of Sewers:</strong></td>
                                        <td><%= event.num_sewers %></td>
                                    </tr>
                                    <tr>
                                        <td><strong>Sewing Ability:</strong></td>
                                        <td><%= event.sewing_ability_description %></td>
                                    </tr>
                                    <tr>
                                        <td><strong>Sewing Machines:</strong></td>
                                        <td><%= event.num_sewing_machines %></td>
                                    </tr>
                                    <tr>
                                        <td><strong>Sergers:</strong></td>
                                        <td><%= event.num_sergers %></td>
                                    </tr>
                                    <tr>
                                        <td><strong>Notes:</strong></td>
                                        <td><%= event.notes %></td>
                                    </tr>
                                    <tr>
                                        <td><strong>Status:</strong></td>
                                        <td><%= event.event_status %></td>
                                    </tr>
                                    <tr>
                                        <td><strong>Jen Story:</strong></td>
                                        <td><%= event.jen_story %></td>
                                    </tr>
                                    <tr>
                                        <td><strong>Material Costs:</strong></td>
                                        <td><%= event.contribute_materials_cost %></td>
                                    </tr>
                                </tbody>
                            </table>
                        </td>
                    </tr>
                <% }) %>
            </tbody>
        </table>
        
        <script>
            document.addEventListener('DOMContentLoaded', () => {
                // Attach click event to rows
                document.querySelectorAll('.clickable-row').forEach(row => {
                    row.addEventListener('click', (e) => {
                        // Prevent the click from triggering when clicking buttons
                        if (e.target.tagName === 'BUTTON') return;
        
                        const eventId = row.getAttribute('data-id');
                        const detailsRow = document.getElementById(`details-${eventId}`);
                        
                        // Toggle display
                        if (detailsRow.style.display === 'none') {
                            detailsRow.style.display = '';
                        } else {
                            detailsRow.style.display = 'none';
                        }
                    });
                });
            });
        
            // Edit handler (to be implemented)
            function handleEdit(eventId) {
                window.location.href = `/edit-event/${eventId}`; // Adjust route as needed
            }
        
            // Delete handler (with confirmation)
            function handleDelete(eventId) {
                if (confirm("Are you sure you want to delete this event?")) {
                    fetch(`/delete-event/${eventId}`, { method: 'DELETE' })
                        .then(response => {
                            if (response.ok) {
                                alert("Event deleted successfully!");
                                location.reload(); // Reload the page to reflect changes
                            } else {
                                alert("Failed to delete event.");
                            }
                        });
                }
            }
        </script>
        
        
        <!-- Pagination Controls -->
        <div class="pagination">
            <% if (currentPage > 1) { %>
                <a href="/maintain-events?page=<%= currentPage - 1 %>">Previous</a>
            <% } %>
        
            <% for (let i = 1; i <= totalPages; i++) { %>
                <a href="/maintain-events?page=<%= i %>" 
                   class="<%= i === currentPage ? 'active' : '' %>"><%= i %></a>
            <% } %>
        
            <% if (currentPage < totalPages) { %>
                <a href="/maintain-events?page=<%= currentPage + 1 %>">Next</a>
            <% } %>
        </div>
        
        <!-- Button to add a new event -->
        <div>
            <a href="/add-event"><button>Add New Event</button></a>
        </div>
        
</body>
</html>